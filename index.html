<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JM Game Shop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- General Setup --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Poppins', sans-serif;
            color: white;
            background-color: #000;
            background-image: url('https://i.pinimg.com/736x/e3/d5/03/e3d503ffbdbf4413bbc2c795a989e489.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            width: 100vw; min-height: 100vh;
            transition: background-image 0.8s ease-in-out;
        }

        @keyframes rgbCycle {
            0% { border-color: #ff0000; box-shadow: 0 0 12px #ff0000; }
            25% { border-color: #00ff00; box-shadow: 0 0 12px #00ff00; }
            50% { border-color: #0000ff; box-shadow: 0 0 12px #0000ff; }
            75% { border-color: #ffff00; box-shadow: 0 0 12px #ffff00; }
            100% { border-color: #ff00ff; box-shadow: 0 0 12px #ff00ff; }
        }

        /* --- 1. Splash Screen --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .splash-logo {
            width: 120px; height: 120px; border-radius: 50%;
            border: 3px solid #f1c40f; box-shadow: 0 0 20px rgba(241, 196, 15, 0.4);
            margin-bottom: 15px; object-fit: cover;
        }

        .bg-spacer { height: 12vh; width: 100%; }

        /* --- 2. Menu Screen --- */
        #menu-screen {
            display: none; flex-direction: column; align-items: center;
            min-height: 100vh; width: 100%;
            background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.85) 25%);
        }
        .menu-title { font-size: 18px; font-weight: bold; color: #f1c40f; margin-bottom: 25px; letter-spacing: 2px; }
        
        .game-btn {
            display: flex; align-items: center; width: 88%; max-width: 350px; height: 80px;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 18px; margin-bottom: 15px;
            cursor: pointer; padding: 10px; transition: 0.3s;
        }
        .game-icon { width: 60px; height: 60px; border-radius: 12px; object-fit: cover; }
        .game-info { flex: 1; padding-left: 15px; font-weight: bold; }

        .history-btn-main {
            width: 88%; max-width: 350px; padding: 12px; border: 1px solid #f1c40f;
            border-radius: 12px; background: rgba(241, 196, 15, 0.1); color: #f1c40f;
            text-align: center; font-weight: bold; margin-top: 10px; cursor: pointer;
        }

        /* --- 3. Shop Screen --- */
        .container {
            display: none; width: 100%; min-height: 100vh;
            background: linear-gradient(to bottom, transparent 0%, rgba(10, 10, 10, 0.96) 20%);
            padding: 0 15px 140px;
        }
        .shop-header {
            display: flex; align-items: center; gap: 12px;
            background: rgba(255,255,255,0.08); padding: 10px 15px;
            border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 15px;
        }
        
        .id-group { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-box {
            flex: 1; padding: 14px; border-radius: 12px;
            background: rgba(0,0,0,0.5); border: 2px solid #333;
            color: #fff; text-align: center; font-size: 14px; outline: none;
        }
        #nameDisplay { min-height: 25px; text-align: center; font-size: 13px; color: #00ff88; margin-bottom: 15px; line-height: 1.4; }

        .cat-label { color: #f1c40f; font-size: 12px; font-weight: bold; margin: 20px 0 10px; display: flex; align-items: center; gap: 8px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .item-card {
            background: rgba(255, 255, 255, 0.05); border: 1.5px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px; padding: 12px 8px; text-align: center; cursor: pointer; transition: 0.3s;
        }
        .item-card.active { animation: rgbCycle 3s infinite linear; background: rgba(255, 255, 255, 0.15); }
        .item-card img { width: 35px; margin-bottom: 6px; }
        .item-name { font-size: 11px; font-weight: bold; color: #eee; display: block; }
        .item-price { font-size: 13px; font-weight: bold; color: #00ff88; display: block; }

        /* Quantity Control */
        .qty-control {
            display: flex; align-items: center; justify-content: center;
            gap: 20px; margin: 10px 0; background: rgba(255,255,255,0.05);
            padding: 10px; border-radius: 12px; border: 1px solid #333;
        }
        .qty-btn {
            width: 35px; height: 35px; border-radius: 50%; border: 1.5px solid #f1c40f;
            background: none; color: #f1c40f; font-size: 20px; cursor: pointer;
        }
        #qty-val { font-size: 18px; font-weight: bold; min-width: 30px; text-align: center; }

        /* Summary Amount Display */
        #orderSummary {
            background: rgba(241, 196, 15, 0.15); border: 1px solid #f1c40f;
            padding: 10px; border-radius: 10px; text-align: center; margin-bottom: 15px;
            display: none; animation: fadeIn 0.5s;
        }
        #summaryText { font-size: 14px; font-weight: bold; color: #f1c40f; }

        /* Payment Details & Copy */
        #payment-details {
            display: none; background: rgba(241, 196, 15, 0.1); border: 1px solid #f1c40f;
            border-radius: 12px; padding: 15px; margin-top: 15px; text-align: center; position: relative;
        }
        .copy-icon {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            color: #f1c40f; font-size: 20px; cursor: pointer; padding: 5px;
        }
        .copy-icon:active { color: #fff; transform: translateY(-50%) scale(1.2); }
        
        .pay-number { font-size: 18px; font-weight: bold; color: #f1c40f; display: block; margin: 5px 0; }
        .pay-row { display: flex; gap: 10px; margin-top: 10px; }
        .pay-box { flex: 1; background: rgba(255,255,255,0.05); border-radius: 12px; padding: 10px; text-align: center; border: 1.5px solid transparent; cursor: pointer; }
        .pay-box.active { border-color: #00ff88; background: rgba(0,255,136,0.1); }
        .pay-logo { width: 30px; border-radius: 6px; margin-bottom: 4px; }

        .upload-area { border: 2px dashed #444; border-radius: 15px; padding: 20px; text-align: center; margin-top: 15px; background: rgba(0,0,0,0.2); cursor: pointer; }
        #previewImg { width: 100%; border-radius: 10px; margin-top: 10px; display: none; }

        .footer { position: fixed; bottom: 0; left: 0; width: 100%; padding: 15px; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 1000; }
        .main-btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; background: #333; color: #777; transition: 0.3s; }
        .main-btn.active { background: linear-gradient(45deg, #f1c40f, #e67e22); color: #000; cursor: pointer; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* History */
        .history-card { background: rgba(255,255,255,0.05); border: 1px solid #333; border-radius: 15px; padding: 15px; margin-bottom: 12px; }
        .h-price { color: #00ff88; font-weight: bold; float: right; }

        #loadingOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid #f1c40f; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="splash-screen">
    <img src="https://scontent.fbkk19-1.fna.fbcdn.net/v/t39.30808-6/540641345_122132544716926701_3529674997104008223_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=wTjOEAxcU0AQ7kNvwFZ6ig5&_nc_oc=AdnmnnhfXFtortGipVNxfkEn76lggT2JhAYC9uOCMhCury5YJkmqHDCw7h4Vy6rNA94&_nc_zt=23&_nc_ht=scontent.fbkk19-1.fna&_nc_gid=Tkb6-k-tMfU-5FIXRWGBGA&oh=00_AfpACSDiXYRY6EwLqVI2EEat3-xBPmdNaYIwaxBgaJ_Iig&oe=6979730F" class="splash-logo">
    <p style="color: #f1c40f; letter-spacing: 2px; font-weight: bold;">JM GAME SHOP</p>
</div>

<div id="menu-screen">
    <div class="bg-spacer"></div>
    <div class="menu-title">SELECT GAME</div>
    <div class="game-btn" onclick="loadShop('PUBG')">
        <img src="https://cdn1.codashop.com/S/content/mobile/images/product-tiles/pubgm_tile_aug2024.jpg" class="game-icon">
        <div class="game-info">PUBG MOBILE</div>
    </div>
    <div class="game-btn" onclick="loadShop('MLBB')">
        <img src="https://cdn1.codashop.com/S/content/mobile/images/product-tiles/MLBB-2025-tiles-178x178.jpg" class="game-icon">
        <div class="game-info">MOBILE LEGENDS</div>
    </div>
    <div class="history-btn-main" onclick="showHistory()"><i class="fa-solid fa-clock-rotate-left"></i> Order History</div>
</div>

<div class="container" id="shop-screen">
    <div class="bg-spacer"></div>
    <div class="shop-header">
        <i class="fa-solid fa-arrow-left" onclick="goBack()" style="cursor:pointer; color:#f1c40f;"></i>
        <span id="shop-title" style="font-weight:bold; margin-left:10px;">Shop</span>
    </div>

    <div class="id-group">
        <input type="number" id="gameId" class="input-box" placeholder="User ID" oninput="handleInput()">
        <input type="number" id="serverId" class="input-box" style="flex:0.6; display:none;" placeholder="Zone" oninput="handleInput()">
    </div>
    <div id="nameDisplay"></div>

    <div id="dynamicItems"></div>

    <div class="cat-label"><i class="fa-solid fa-layer-group"></i> Quantity</div>
    <div class="qty-control">
        <button class="qty-btn" onclick="updateQty(-1)">‚àí</button>
        <span id="qty-val">1</span>
        <button class="qty-btn" onclick="updateQty(1)">+</button>
    </div>

    <div id="orderSummary">
        <div id="summaryText"></div>
    </div>

    <div class="cat-label">Payment Method</div>
    <div class="pay-row">
        <div class="pay-box" onclick="selectPayment('kpay', '09759777632', 'Sai kwam khay')">
            <img src="https://www.kbzpay.com/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fblue-L.c7123311.webp&w=64&q=75" class="pay-logo"><br>KPay
        </div>
        <div class="pay-box" onclick="selectPayment('wavemoney', '09759777632', 'Sai kwam khay')">
            <img src="https://play-lh.googleusercontent.com/rPq4GMCZy12WhwTlanEu7RzxihYCgYevQHVHLNha1VcY5SU1uLKHMd060b4VEV1r-OQ=s48-rw" class="pay-logo"><br>wavemoney
        </div>
    </div>

    <div id="payment-details">
        <span id="pay-method-name" style="font-weight:bold; color:#fff;">KPay ·Äî·Ä∂·Äï·Ä´·Äê·Ä∫</span>
        <span class="pay-number" id="display-pay-num">09759777632</span>
        <i class="fa-solid fa-copy copy-icon" onclick="copyNum()"></i>
        <span class="pay-name" id="display-pay-name">Name: Sai kwam khay</span>
    </div>

    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <i class="fa-solid fa-camera" style="font-size:20px; color:#666; margin-bottom:5px;"></i>
        <div id="uploadText" style="font-size:11px; color:#aaa;">·ÄÑ·ÄΩ·Ä±·Äú·ÄΩ·Äæ·Ä≤ Screenshot ·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫</div>
        <img id="previewImg">
        <input type="file" id="fileInput" accept="image/*" onchange="previewFile()" style="display:none;">
    </div>
</div>

<div class="container" id="history-screen">
    <div class="bg-spacer"></div>
    <div class="shop-header">
        <i class="fa-solid fa-arrow-left" onclick="goBack()" style="cursor:pointer; color:#f1c40f;"></i>
        <span style="font-weight:bold; margin-left:10px;">ORDER HISTORY</span>
    </div>
    <div id="historyList"></div>
</div>

<div class="footer" id="footerBar" style="display:none;">
    <button id="orderBtn" class="main-btn">·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äï·Ä´</button>
</div>

<div id="loadingOverlay"><div class="spinner"></div></div>

<script>
    const API_KEY = 'ab7d95df0emshbf94ddf5eaaba04p189129jsn9f195b7147fd';
    const BOT_T = "7677213934:AAEUQt0DA2nQs2GTJZa9hPDiB3n83tuxo_s";
    const ADMIN_ID = "1820840235";

    let activeG = "", sD = "", sP = 0, pNm = "N/A", pMt = "", pCt = "Myanmar üá≤üá≤", qty = 1;

    setTimeout(() => { 
        document.getElementById('splash-screen').style.display = 'none'; 
        document.getElementById('menu-screen').style.display = 'flex'; 
    }, 2000);

    const mlData = {
        weekly: { n: "Weekly Pass", p: 6100, icon: "https://img.smile.one/media/catalog/product/1/5q/15qtr79kjv14qfe1691739555.png" },
        promo: [
            {n:"50+50 Bonus", p:3500}, {n:"150+150 Bonus", p:9900},
            {n:"250+250 Bonus", p:15700}, {n:"500+500 Bonus", p:31600}
        ],
        normal: [
            {n:"11 Dia",p:1100},{n:"22 Dia",p:1900},{n:"56 Dia",p:4600},{n:"86 Dia",p:5300},{n:"112 Dia",p:8600},{n:"172 Dia",p:10300},
            {n:"257 Dia",p:14900},{n:"343 Dia",p:19700},{n:"429 Dia",p:24600},{n:"514 Dia",p:29600},{n:"600 Dia",p:34100},{n:"706 Dia",p:39600},
            {n:"878 Dia",p:49600},{n:"1049 Dia",p:59600},{n:"2195 Dia",p:122100},{n:"3688 Dia",p:200100},{n:"5532 Dia",p:299100},{n:"9288 Dia",p:495100}
        ]
    };

    const pubgData = [
        {n:"60 UC",p:4100},{n:"120 UC",p:8100},{n:"180 UC",p:12100},{n:"240 UC",p:16100},{n:"325 UC",p:20100},{n:"660 UC",p:39600},
        {n:"1800 UC",p:99100},{n:"3850 UC",p:196100},{n:"8100 UC",p:388100}
    ];

    function loadShop(g) {
        activeG = g; qty = 1; document.getElementById('qty-val').innerText = qty;
        const container = document.getElementById('dynamicItems');
        container.innerHTML = "";
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('shop-screen').style.display = 'block';
        document.getElementById('footerBar').style.display = 'block';

        if (g === 'MLBB') {
            document.body.style.backgroundImage = "url('https://i.pinimg.com/736x/3f/70/30/3f70302038628c40b6346be202c88d37.jpg')";
            document.getElementById('shop-title').innerText = "MOBILE LEGENDS";
            document.getElementById('serverId').style.display = 'block';
            
            container.innerHTML += `<div class="cat-label">Weekly Pass</div><div class="grid"><div class="item-card" style="grid-column: span 2;" onclick="selectItem(this,'${mlData.weekly.n}',${mlData.weekly.p})"><img src="${mlData.weekly.icon}"><br><span class="item-name">${mlData.weekly.n}</span><span class="item-price">${mlData.weekly.p.toLocaleString()} ks</span></div></div>`;
            
            let bth = `<div class="cat-label">Double Diamond (Promo)</div><div class="grid">`;
            mlData.promo.forEach(i => { bth += `<div class="item-card" onclick="selectItem(this,'${i.n}',${i.p})"><img src="https://cdn1.codashop.com/images/106_5e7a01a7-89b9-4b13-a512-a3e72f63f0d1_product/1760334222477_bdd28040-0bd9-4dff-b748-ed7b1a0aecdd.png"><br><span class="item-name">${i.n}</span><span class="item-price">${i.p.toLocaleString()} ks</span></div>`; });
            container.innerHTML += bth + "</div>";

            let nth = `<div class="cat-label">Diamonds</div><div class="grid">`;
            mlData.normal.forEach(i => { nth += `<div class="item-card" onclick="selectItem(this,'${i.n}',${i.p})"><img src="https://cdn1.codashop.com/images/106_5e7a01a7-89b9-4b13-a512-a3e72f63f0d1_product/1760335249005_d119a418-95ae-4562-bd62-135e57cf7504.png"><br><span class="item-name">${i.n}</span><span class="item-price">${i.p.toLocaleString()} ks</span></div>`; });
            container.innerHTML += nth + "</div>";
        } else {
            document.body.style.backgroundImage = "url('https://i.pinimg.com/736x/73/6c/39/736c3979a02d2a369cec2a50b45666cb.jpg')";
            document.getElementById('shop-title').innerText = "PUBG MOBILE UC";
            document.getElementById('serverId').style.display = 'none';
            let pth = `<div class="cat-label">PUBG Mobile UC (All Server)</div><div class="grid">`;
            pubgData.forEach(i => { pth += `<div class="item-card" onclick="selectItem(this,'${i.n}',${i.p})"><img src="https://img.smile.one/media/catalog/product/n/an/nan0ugwrgqjkjmi1611217417.png"><br><span class="item-name">${i.n}</span><span class="item-price">${i.p.toLocaleString()} ks</span></div>`; });
            container.innerHTML += pth + "</div>";
        }
        validate();
    }

    function selectItem(el, n, p) {
        document.querySelectorAll('.item-card').forEach(i => i.classList.remove('active'));
        el.classList.add('active'); sD = n; sP = p; validate();
    }

    function updateQty(val) {
        qty = Math.max(1, qty + val);
        document.getElementById('qty-val').innerText = qty;
        validate();
    }

    function selectPayment(mt, num, name) {
        pMt = mt;
        document.querySelectorAll('.pay-box').forEach(i => i.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById('payment-details').style.display = 'block';
        document.getElementById('pay-method-name').innerText = mt.toUpperCase() + " ·Äî·Ä∂·Äï·Ä´·Äê·Ä∫";
        document.getElementById('display-pay-num').innerText = num;
        document.getElementById('display-pay-name').innerText = "Name: " + name;
        validate();
    }

    function copyNum() {
        const num = document.getElementById('display-pay-num').innerText;
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(num).then(() => {
                alert("Copied: " + num);
            }).catch(err => {
                fallbackCopy(num);
            });
        } else {
            fallbackCopy(num);
        }
    }

    function fallbackCopy(text) {
        const el = document.createElement('textarea');
        el.value = text;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        alert("Copied: " + text);
    }

    function previewFile() {
        const file = document.getElementById('fileInput').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => { 
                document.getElementById('previewImg').src = e.target.result; 
                document.getElementById('previewImg').style.display = "block"; 
                document.getElementById('uploadText').style.display = "none"; 
            };
            reader.readAsDataURL(file);
        }
        validate();
    }

    let timer = null;
    function handleInput() { validate(); clearTimeout(timer); timer = setTimeout(checkID, 1200); }

    // Flag mapping function
    function getFlag(region) {
        if (!region) return "üè≥Ô∏è";
        const r = region.toLowerCase();
        if (r.includes("myanmar") || r.includes("mm")) return "üá≤üá≤ Myanmar";
        if (r.includes("philippines") || r.includes("ph")) return "üáµüá≠ Philippines";
        if (r.includes("indonesia") || r.includes("id")) return "üáÆüá© Indonesia";
        if (r.includes("cambodia") || r.includes("kh")) return "üá∞üá≠ Cambodia";
        if (r.includes("malaysia") || r.includes("my")) return "üá≤üáæ Malaysia";
        if (r.includes("singapore") || r.includes("sg")) return "üá∏üá¨ Singapore";
        if (r.includes("thailand") || r.includes("th")) return "üáπüá≠ Thailand";
        if (r.includes("vietnam") || r.includes("vn")) return "üáªüá≥ Vietnam";
        if (r.includes("brazil") || r.includes("br")) return "üáßüá∑ Brazil";
        return "üåç " + region;
    }

    async function checkID() {
        const id = document.getElementById('gameId').value;
        const sid = document.getElementById('serverId').value;
        if(!id || id.length < 5) return;
        document.getElementById('nameDisplay').innerText = "Checking...";
        try {
            const url = activeG === 'PUBG' ? `https://check-id-game.p.rapidapi.com/api/rapid_api/cekpubgmobile/${id}` : `https://check-id-game.p.rapidapi.com/api/rapid_api/cek_game_ml/${id}/${sid}`;
            const res = await fetch(url, { headers: { 'x-rapidapi-key': API_KEY, 'x-rapidapi-host': 'check-id-game.p.rapidapi.com' } });
            const data = await res.json();
            if(data.success) { 
                pNm = data.data.username || data.data.name; 
                const rawRegion = data.data.region || "Myanmar";
                pCt = getFlag(rawRegion);
                
                // Display username and country with flag
                document.getElementById('nameDisplay').innerHTML = `
                    <div style="font-weight:bold; color:#00ff88;">‚úÖ ${pNm}</div>
                    <div style="font-size:11px; color:#aaa; margin-top:2px;">Country: ${pCt}</div>
                `;
            } else { 
                document.getElementById('nameDisplay').innerText = "‚ùå ID Not Found"; pNm = "Unknown";
            }
        } catch(e) { document.getElementById('nameDisplay').innerText = "Network Error"; }
        validate();
    }

    function validate() {
        const btn = document.getElementById('orderBtn');
        const summary = document.getElementById('orderSummary');
        const summaryText = document.getElementById('summaryText');
        const hasFile = document.getElementById('fileInput').files.length > 0;
        const hasId = document.getElementById('gameId').value.length >= 5;
        
        const total = (sP * qty).toLocaleString();

        // Update Quantity Amount Display
        if (sD) {
            summary.style.display = 'block';
            summaryText.innerHTML = `${sD} <span style="color:#fff">x</span> ${qty} = <span style="color:#00ff88">${total} ks</span>`;
        }

        if(hasId && sD && pMt && hasFile) { 
            btn.classList.add('active'); btn.innerText = `CONFIRM - ${total} ks`; btn.onclick = sendOrder; 
        } else { 
            btn.classList.remove('active'); btn.innerText = "·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äï·Ä´"; btn.onclick = null; 
        }
    }

    function goBack() { location.reload(); }

    function showHistory() {
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('history-screen').style.display = 'block';
        const list = document.getElementById('historyList');
        const history = JSON.parse(localStorage.getItem('jm_orders') || '[]');
        if (history.length === 0) { list.innerHTML = `<p style="text-align:center; color:#666; margin-top:50px;">Order ·Äõ·Ä¨·Äá·Äù·ÄÑ·Ä∫ ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´·Åã</p>`; }
        else { list.innerHTML = history.reverse().map(h => `<div class="history-card"><span class="h-price">${h.price}</span><div style="color:#f1c40f; font-weight:bold;">${h.id}</div><div style="font-size:12px; color:#aaa; margin:4px 0;">${h.game} | ${h.gameId}</div><div style="font-size:11px; color:#666;">${h.time}</div></div>`).join(''); }
    }

    async function sendOrder() {
        const loading = document.getElementById('loadingOverlay');
        loading.style.display = 'flex';
        try {
            const orderID = "JM-" + Math.floor(100000 + Math.random() * 900000);
            const tg = window.Telegram.WebApp;
            const user = tg.initDataUnsafe.user || {};
            const customerId = user.id || "Unknown";
            const orderTime = new Date().toLocaleString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }).toLowerCase();
            const gId = document.getElementById('gameId').value;
            const sId = document.getElementById('serverId').value;
            const totalPrice = (sP * qty).toLocaleString() + " ks";

            // Save History
            const myOrders = JSON.parse(localStorage.getItem('jm_orders') || '[]');
            myOrders.push({ id: orderID, game: activeG, gameId: gId, price: totalPrice, time: orderTime });
            localStorage.setItem('jm_orders', JSON.stringify(myOrders));

            // Admin Caption (Fixed Item x Qty Format)
            let adminCaption = `üßæ <b>NEW ORDER: ${orderID}</b>\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            adminCaption += `üéÆ <b>Game:</b> ${activeG}\n`;
            adminCaption += `üÜî <b>ID:</b> <code>${gId}</code> ${sId ? '('+sId+')' : ''}\n`;
            adminCaption += `üë§ <b>Name:</b> ${pNm}\n`;
            adminCaption += `üåç <b>Region:</b> ${pCt}\n`;
            adminCaption += `üíé <b>Item:</b> ${sD} <b>x ${qty}</b>\n`;
            adminCaption += `üí∞ <b>Total Price:</b> ${totalPrice}\n`;
            adminCaption += `üè¶ <b>Pay:</b> ${pMt.toUpperCase()}\n`;
            adminCaption += `üìÖ <b>Time:</b> ${orderTime}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            adminCaption += `üë§ <b>Cust ID:</b> <code>${customerId}</code>`;

            const formData = new FormData();
            formData.append("chat_id", ADMIN_ID);
            formData.append("photo", document.getElementById('fileInput').files[0]);
            formData.append("caption", adminCaption);
            formData.append("parse_mode", "HTML");
            formData.append("reply_markup", JSON.stringify({
                inline_keyboard: [[
                    { text: "‚úÖ Confirm", callback_data: `ok_${orderID}` },
                    { text: "‚ùå Reject", callback_data: `no_${orderID}` }
                ]]
            }));

            const response = await fetch(`https://api.telegram.org/bot${BOT_T}/sendPhoto`, { method: 'POST', body: formData });
            if (response.ok) {
                // Customer Message
                let customerText = `‚åõ <b>Order ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫!</b>\n\n`;
                customerText += `üÜî <b>Order ID:</b> ${orderID}\n`;
                customerText += `üíé <b>·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏:</b> ${sD} x ${qty}\n`;
                customerText += `üí∞ <b>·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÄ·Äª·Äû·ÄÑ·Ä∑·Ä∫·ÄÑ·ÄΩ·Ä±:</b> ${totalPrice}\n\n`;
                customerText += `Admin ·Äô·Äæ ·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·ÄÄ ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä±·Ä∏·Äû·ÄΩ·Ä¨·Ä∏·Äô·Ää·Ä∫ ·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã`;
                
                await fetch(`https://api.telegram.org/bot${BOT_T}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: customerId, text: customerText, parse_mode: "HTML" })
                });

                tg.showAlert(`‚úÖ Order Successful!\nID: ${orderID}`);
                tg.close();
            } else { alert("Telegram Bot Error."); }
        } catch (e) { alert("System Error: " + e.message); } finally { loading.style.display = 'none'; }
    }
</script>
</body>
</html>