<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JM Game Shop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- General Setup --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body {
    font-family: 'Poppins', sans-serif;
    color: white;
    background-color: #000;
    background-repeat: no-repeat;
    background-size: cover; 
    background-position: center center;
    background-attachment: fixed; /* ·Ä§·Äú·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·ÄÄ list ·Äõ·ÄΩ·Ä±·Ä∑·Äû·Ä±·Ä¨·Ä∫·Äú·Ää·Ä∫·Ä∏ background ·ÄÄ·Ä≠·ÄØ ·ÄÑ·Äº·Ä≠·Äô·Ä∫·ÄÖ·Ä±·Äï·Ä´·Äû·Ää·Ä∫ */
    width: 100vw; 
    min-height: 100vh;
    transition: background-image 0.6s ease-in-out;
    overflow-x: hidden;
}

        /* --- Animations --- */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes glow { 0% { box-shadow: 0 0 5px #f1c40f; } 50% { box-shadow: 0 0 20px #f1c40f; } 100% { box-shadow: 0 0 5px #f1c40f; } }

        /* --- Screens --- */
        #splash-screen, #menu-screen, #shop-step-1, #shop-step-2, #history-screen {
            display: none; width: 100%; min-height: 100vh;
            padding-bottom: 90px; /* Space for footer */
        }
        
        #splash-screen {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: #000; z-index: 9999; position: fixed; top: 0; left: 0; height: 100%;
        }
        .splash-logo {
            width: 130px; height: 130px; border-radius: 50%;
            border: 4px solid #f1c40f; box-shadow: 0 0 30px rgba(241, 196, 15, 0.6);
            margin-bottom: 20px; object-fit: cover; animation: glow 2s infinite;
        }

        /* --- Glassmorphism Containers --- */
        /* ·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·Ä∂·Äï·ÄØ·Ä∂·ÄÄ·Ä≠·ÄØ ·Äï·Ä≠·ÄØ·Äô·Äº·ÄÑ·Ä∫·Äõ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ ·Ä°·Äô·Ää·Ä∫·Ä∏·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Ä°·Äï·Ä´·Ä∏ (Transparent) ·ÄÄ·Ä≠·ÄØ·Äû·ÄØ·Ä∂·Ä∏·Äë·Ä¨·Ä∏·Äû·Ää·Ä∫ */
        .container, #menu-screen {
    padding: 0 15px; 
    background: rgba(0, 0, 0, 0.2); /* 0.25 ·Äô·Äæ 0.2 ·Äû·Ä≠·ÄØ·Ä∑ ·Äú·Äª·Äæ·Ä±·Ä¨·Ä∑·ÄÅ·Äª·Äï·Ä´·ÄÄ background ·Äï·Ä≠·ÄØ·Äô·Äº·ÄÑ·Ä∫·Äõ·Äô·Ää·Ä∫ */
    backdrop-filter: blur(2px); /* Blur ·ÄÄ·Ä≠·ÄØ·Äú·Ää·Ä∫·Ä∏ 2px ·ÄÅ·Äî·Ä∑·Ä∫·Äë·Ä≠ ·Äú·Äª·Äæ·Ä±·Ä¨·Ä∑·Äï·Ä±·Ä∏·Äï·Ä´ */
    width: 100%;
    box-sizing: border-box;
}
        
        .bg-spacer { height: 10vh; width: 100%; }

        /* --- Headers --- */
        .shop-header {
            display: flex; align-items: center; gap: 12px;
            background: rgba(255, 255, 255, 0.1); /* Glassy */
            padding: 12px 15px; border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* --- Menu Buttons --- */
#menu-screen {
    display: none; 
    flex-direction: column;
    justify-content: center; /* ·Ä°·Äï·Ä±·Ä´·Ä∫·Ä°·Ä±·Ä¨·ÄÄ·Ä∫ ·Ä°·Äú·Äö·Ä∫·Äó·Äü·Ä≠·ÄØ ·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä±·Ä∏·Äû·Ää·Ä∫ */
    align-items: center;     /* ·Äò·Äö·Ä∫·Ää·Ä¨ ·Ä°·Äú·Äö·Ä∫·Äó·Äü·Ä≠·ÄØ ·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä±·Ä∏·Äû·Ää·Ä∫ */
    min-height: 100vh;       /* Screen ·Ä°·Äï·Äº·Ää·Ä∑·Ä∫·Äö·Ä∞·Äë·Ä¨·Ä∏·Äô·Äæ ·Ä°·Äú·Äö·Ä∫·ÄÅ·Äª·Ä≠·Äî·Ä∫·Äú·Ä≠·ÄØ·Ä∑·Äõ·Äô·Äæ·Ä¨·Äï·Ä´ */
    padding: 20px;
    box-sizing: border-box;
}

.menu-title { 
    font-size: 24px; 
    font-weight: bold; 
    color: #f1c40f; 
    text-shadow: 0 0 15px rgba(241, 196, 15, 0.5);
    margin-bottom: 40px; 
    letter-spacing: 2px; 
    text-align: center;
}
        
.game-btn {
    display: flex; 
    align-items: center; 
    width: 95%; /* ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äô·Äæ·Ä¨ ·Äï·Ä≠·ÄØ·ÄÄ·Äº·Ää·Ä∑·Ä∫·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ ·Äî·Ää·Ä∫·Ä∏·Äî·Ää·Ä∫·Ä∏·ÄÅ·Äª·Ä≤·Ä∑·Äë·Ä¨·Ä∏·Äï·Ä´·Äê·Äö·Ä∫ */
    max-width: 380px; 
    height: 85px;
    background: rgba(20, 20, 20, 0.6); /* ·Äï·Ä≠·ÄØ·ÄÄ·Äº·Ää·Ä∫·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ 0.6 ·Äë·Ä¨·Ä∏·Äë·Ä¨·Ä∏·Äï·Ä´·Äê·Äö·Ä∫ */
    border: 1px solid rgba(255, 255, 255, 0.3); 
    border-radius: 20px; 
    margin-bottom: 18px;
    cursor: pointer; 
    padding: 12px; 
    transition: 0.3s;
    backdrop-filter: blur(8px); /* Blur ·Äï·Ä≠·ÄØ·Äê·ÄÑ·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä±·Ä∏·Äú·Ä≠·ÄØ·Ä∑ background ·Äï·Ä≠·ÄØ·ÄÄ·Äº·Ää·Ä∫·Äô·Äö·Ä∫ */
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}

.game-btn:active { 
    transform: scale(0.96); 
    border-color: #f1c40f; 
    background: rgba(241, 196, 15, 0.2); 
}

.game-icon { 
    width: 60px; 
    height: 60px; 
    border-radius: 14px; 
    object-fit: cover; 
    border: 2px solid rgba(255,255,255,0.8); 
}

.game-info { 
    flex: 1; 
    padding-left: 15px; 
    font-weight: bold; 
    font-size: 16px; 
    color: #fff; 
    text-shadow: 1px 1px 3px black; 
}

.history-btn-main {
    width: 95%; 
    max-width: 380px; 
    padding: 14px; 
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px; 
    background: rgba(0, 0, 0, 0.4); 
    color: #ccc; 
    text-align: center; 
    font-weight: bold; 
    margin-top: 25px; 
    cursor: pointer; 
    backdrop-filter: blur(4px);
}
        /* --- Input Fields --- */
        .id-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-box {
            flex: 1; padding: 14px; border-radius: 12px;
            background: rgba(255, 255, 255, 0.15); /* Glassy Input */
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff; text-align: center; font-size: 15px; outline: none;
            backdrop-filter: blur(5px);
        }
        .input-box::placeholder { color: #ddd; }
        .input-box:focus { border-color: #f1c40f; background: rgba(0, 0, 0, 0.6); }

        /* --- Items Grid --- */
        .cat-label { 
            color: #f1c40f; font-size: 14px; font-weight: bold; 
            margin: 25px 0 12px; display: flex; align-items: center; gap: 8px; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        
        .item-card {
    background: rgba(0, 0, 0, 0.3); /* 0.5 ·Äô·Äæ 0.3 ·Äû·Ä≠·ÄØ·Ä∑ ·Äú·Äª·Äæ·Ä±·Ä¨·Ä∑·Äï·Ä´ */
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 16px; 
    padding: 15px 10px; 
    text-align: center; 
    cursor: pointer; 
    transition: 0.2s; 
    backdrop-filter: blur(5px);
}
        /* Active Item Style */
        .item-card.active { 
            background: rgba(241, 196, 15, 0.2); 
            border: 2px solid #f1c40f; 
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.3);
            transform: scale(1.02);
        }
        .item-card img { width: 40px; margin-bottom: 8px; }
        .item-name { font-size: 12px; font-weight: bold; color: #fff; display: block; margin-bottom: 4px; }
        .item-price { font-size: 13px; font-weight: bold; color: #00ff88; display: block; text-shadow: 0 0 5px rgba(0,255,136,0.4); }

        /* --- Quantity Control --- */
        .qty-control {
            display: flex; align-items: center; justify-content: center;
            gap: 25px; margin: 25px 0; 
            background: rgba(255, 255, 255, 0.1);
            padding: 15px; border-radius: 15px; 
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
        }
        .qty-btn {
            width: 45px; height: 45px; border-radius: 50%; 
            border: none; background: #fff; color: #000;
            font-size: 24px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .qty-btn:active { transform: scale(0.9); background: #f1c40f; }
        #qty-val { font-size: 24px; font-weight: bold; color: #fff; text-shadow: 0 2px 4px #000; }

        /* --- Payment Step --- */
        .order-summary-card {
            background: rgba(0, 0, 0, 0.6); 
            border: 2px solid #00ff88;
            border-radius: 16px; padding: 20px; text-align: center; margin-bottom: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0,255,136,0.15);
        }
        
        .pay-row { display: flex; gap: 15px; margin-top: 15px; }
        .pay-box { 
            flex: 1; background: rgba(255, 255, 255, 0.85); /* White glass */
            border-radius: 15px; padding: 15px; text-align: center; 
            border: 3px solid transparent; cursor: pointer; color: #000; font-weight: bold;
            transition: 0.2s;
        }
        .pay-box.active { 
            border-color: #f1c40f; transform: translateY(-3px); 
            box-shadow: 0 5px 15px rgba(241, 196, 15, 0.4);
            background: #fff;
        }
        .pay-logo { width: 40px; border-radius: 8px; margin-bottom: 5px; }

        #payment-details {
            display: none; background: rgba(20, 20, 20, 0.85); 
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px; padding: 20px; margin-top: 20px; text-align: center;
            backdrop-filter: blur(10px);
        }
        .pay-number { font-size: 24px; font-weight: bold; color: #f1c40f; display: block; margin: 12px 0; letter-spacing: 1px; }

        .open-app-btn {
            display: block; width: 100%; margin-top: 15px; padding: 12px; border-radius: 10px;
            text-decoration: none; font-weight: bold; font-size: 15px; text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .upload-area { 
            border: 2px dashed rgba(255,255,255,0.4); 
            border-radius: 16px; padding: 25px; text-align: center; margin-top: 20px; 
            background: rgba(0,0,0,0.3); cursor: pointer; 
        }
        
        /* --- Footer Button (Redesigned) --- */
        .footer { 
            position: fixed; bottom: 0; left: 0; width: 100%; 
            padding: 20px; 
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0)); 
            z-index: 1000; 
            display: flex; justify-content: center;
        }
        .main-btn { 
            width: 100%; max-width: 400px;
            padding: 18px; border: none; border-radius: 16px; 
            font-weight: bold; font-size: 16px; 
            background: rgba(255, 255, 255, 0.15); /* Inactive State */
            color: #888; 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: 0.4s;
        }
        /* Active Button State - Gold/Orange Gradient */
        .main-btn.active { 
            background: linear-gradient(45deg, #f1c40f, #ff9f43); 
            color: #000; cursor: pointer; 
            box-shadow: 0 5px 20px rgba(241, 196, 15, 0.4);
            border: none;
            transform: translateY(-2px);
        }

        /* History */
        .history-card { 
            background: rgba(0, 0, 0, 0.7); 
            border-left: 4px solid #f1c40f; 
            border-radius: 8px; padding: 15px; margin-bottom: 12px; 
            backdrop-filter: blur(4px);
        }
        .h-price { color: #00ff88; font-weight: bold; float: right; }

        #loadingOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); border-top: 5px solid #f1c40f; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="splash-screen" style="display:flex;">
    <img src="https://scontent.fbkk19-1.fna.fbcdn.net/v/t39.30808-6/540641345_122132544716926701_3529674997104008223_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=wTjOEAxcU0AQ7kNvwFZ6ig5&_nc_oc=AdnmnnhfXFtortGipVNxfkEn76lggT2JhAYC9uOCMhCury5YJkmqHDCw7h4Vy6rNA94&_nc_zt=23&_nc_ht=scontent.fbkk19-1.fna&_nc_gid=Tkb6-k-tMfU-5FIXRWGBGA&oh=00_AfpACSDiXYRY6EwLqVI2EEat3-xBPmdNaYIwaxBgaJ_Iig&oe=6979730F" class="splash-logo">
    <p style="color: #f1c40f; letter-spacing: 3px; font-weight: bold; text-shadow: 0 0 10px #000;">JM GAME SHOP</p>
</div>

<div id="menu-screen">
    <div class="bg-spacer"></div>
    <div class="menu-title">SELECT GAME</div>
    <div class="game-btn" onclick="loadShop('PUBG')">
        <img src="https://cdn1.codashop.com/S/content/mobile/images/product-tiles/pubgm_tile_aug2024.jpg" class="game-icon">
        <div class="game-info">PUBG MOBILE</div>
        <i class="fa-solid fa-chevron-right" style="color: #f1c40f;"></i>
    </div>
    <div class="game-btn" onclick="loadShop('MLBB')">
        <img src="https://cdn1.codashop.com/S/content/mobile/images/product-tiles/MLBB-2025-tiles-178x178.jpg" class="game-icon">
        <div class="game-info">MOBILE LEGENDS</div>
        <i class="fa-solid fa-chevron-right" style="color: #f1c40f;"></i>
    </div>
    <div class="history-btn-main" onclick="showHistory()"><i class="fa-solid fa-clock-rotate-left"></i> Order History</div>
</div>

<div id="shop-step-1" class="container">
    <div class="bg-spacer"></div>
    <div class="shop-header">
        <i class="fa-solid fa-arrow-left" onclick="goBack('menu')" style="cursor:pointer; color:#f1c40f; font-size: 20px;"></i>
        <span id="shop-title" style="font-weight:bold; margin-left:15px; font-size: 18px;">Shop</span>
    </div>

    <div class="id-group">
        <input type="number" id="gameId" class="input-box" placeholder="User ID" oninput="handleInput()">
        <input type="number" id="serverId" class="input-box" style="flex:0.6; display:none;" placeholder="Zone" oninput="handleInput()">
    </div>
    <div id="nameDisplay" style="text-align:center; min-height: 20px; font-weight:bold; text-shadow: 1px 1px 2px black;"></div>

    <div id="dynamicItems"></div>

    <div class="cat-label"><i class="fa-solid fa-layer-group"></i> Quantity</div>
    <div class="qty-control">
        <button class="qty-btn" onclick="updateQty(-1)">‚àí</button>
        <span id="qty-val">1</span>
        <button class="qty-btn" onclick="updateQty(1)">+</button>
    </div>
    
    <div class="footer">
        <button id="btnStep1" class="main-btn" onclick="goToPayment()">·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Ä°·Äõ·ÄÑ·Ä∫·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´</button>
    </div>
</div>

<div id="shop-step-2" class="container">
    <div class="bg-spacer"></div>
    <div class="shop-header">
        <i class="fa-solid fa-arrow-left" onclick="goBack('step1')" style="cursor:pointer; color:#f1c40f; font-size: 20px;"></i>
        <span style="font-weight:bold; margin-left:15px; font-size: 18px;">PAYMENT</span>
    </div>

    <div class="order-summary-card">
        <h3 style="color:#ddd; font-size:14px; margin-bottom:5px;">Total Amount</h3>
        <div id="final-price" style="font-size:28px; color:#00ff88; font-weight:bold; text-shadow: 0 0 10px rgba(0,255,136,0.5);">0 ks</div>
        <div id="final-item" style="color:#bbb; font-size:13px; margin-top:5px;">-</div>
    </div>

    <div class="cat-label">Payment Method</div>
    <div class="pay-row">
        <div class="pay-box" onclick="selectPayment('kpay', '09767824618', 'Nang kham oo')">
            <img src="https://www.kbzpay.com/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fblue-L.c7123311.webp&w=64&q=75" class="pay-logo"><br>KPay
        </div>
        <div class="pay-box" onclick="selectPayment('wavemoney', '09767824618', 'Nang kham oo')">
            <img src="https://play-lh.googleusercontent.com/rPq4GMCZy12WhwTlanEu7RzxihYCgYevQHVHLNha1VcY5SU1uLKHMd060b4VEV1r-OQ=s48-rw" class="pay-logo"><br>wavemoney
        </div>
    </div>

    <div id="payment-details">
        <span id="pay-method-name" style="font-weight:bold; color:#fff;">KPay ·Äî·Ä∂·Äï·Ä´·Äê·Ä∫</span>
        <span class="pay-number" id="display-pay-num">09767824618</span>
        <div style="margin-bottom:10px;">
            <button onclick="copyNum()" style="background:#444; color:#fff; border:1px solid #777; padding:8px 15px; border-radius:8px; cursor:pointer;">Copy Number</button>
        </div>
        <span class="pay-name" id="display-pay-name" style="color:#ccc;">Name: Nang kham oo</span>
        
        <a href="#" id="open-app-link" class="open-app-btn">
            üì≤ Open App
        </a>
    </div>

    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <i class="fa-solid fa-camera" style="font-size:24px; color:#eee; margin-bottom:10px;"></i>
        <div id="uploadText" style="font-size:12px; color:#ccc; font-weight:bold;">·ÄÑ·ÄΩ·Ä±·Äú·ÄΩ·Äæ·Ä≤ Screenshot ·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´</div>
        <img id="previewImg" style="width:100%; border-radius:10px; margin-top:10px; display:none;">
        <input type="file" id="fileInput" accept="image/*" onchange="previewFile()" style="display:none;">
    </div>

    <div class="footer">
        <button id="btnStep2" class="main-btn" onclick="sendOrder()">Confirm Order</button>
    </div>
</div>

<div id="history-screen" class="container">
    <div class="bg-spacer"></div>
    <div class="shop-header">
        <i class="fa-solid fa-arrow-left" onclick="goBack('menu')" style="cursor:pointer; color:#f1c40f; font-size:20px;"></i>
        <span style="font-weight:bold; margin-left:15px;">ORDER HISTORY</span>
    </div>
    <div id="historyList"></div>
</div>

<div id="loadingOverlay"><div class="spinner"></div></div>

<script>
    const API_KEY = 'ab7d95df0emshbf94ddf5eaaba04p189129jsn9f195b7147fd';
    const BOT_T = "7677213934:AAEUQt0DA2nQs2GTJZa9hPDiB3n83tuxo_s";
    const ADMIN_ID = "1820840235";

    let activeG = "", sD = "", sP = 0, pNm = "N/A", pMt = "", pCt = "Myanmar üá≤üá≤", qty = 1;
    let totalPrice = 0;

    // Background URLs
    const BG_MENU = "url('https://i.pinimg.com/736x/e3/d5/03/e3d503ffbdbf4413bbc2c795a989e489.jpg')";
    const BG_ML_SHOP = "url('https://i.pinimg.com/736x/3f/70/30/3f70302038628c40b6346be202c88d37.jpg')";
    const BG_ML_PAY = "url('https://i.pinimg.com/736x/08/0d/cf/080dcf0cb441d3acd3d1218c7e7b0eda.jpg')";
    const BG_PUBG_SHOP = "url('https://i.pinimg.com/736x/73/6c/39/736c3979a02d2a369cec2a50b45666cb.jpg')";
    const BG_PUBG_PAY = "url('https://i.pinimg.com/736x/98/81/c5/9881c55ac808087d44720bc539ab9326.jpg')";

    // Init
    setTimeout(() => { 
        document.getElementById('splash-screen').style.display = 'none'; 
        document.getElementById('menu-screen').style.display = 'flex'; 
        document.body.style.backgroundImage = BG_MENU;
    }, 2000);

    // Data
    const mlData = {
        weekly: { n: "Weekly Pass", p: 6100, icon: "https://img.smile.one/media/catalog/product/1/5q/15qtr79kjv14qfe1691739555.png" },
        promo: [
            {n:"50+50 Bonus", p:3500}, {n:"150+150 Bonus", p:9900},
            {n:"250+250 Bonus", p:15700}, {n:"500+500 Bonus", p:31600}
        ],
        normal: [
            {n:"11 Dia",p:1100},{n:"22 Dia",p:1900},{n:"56 Dia",p:4600},{n:"86 Dia",p:5300},{n:"112 Dia",p:8600},{n:"172 Dia",p:10300},
            {n:"257 Dia",p:14900},{n:"343 Dia",p:19700},{n:"429 Dia",p:24600},{n:"514 Dia",p:29600},{n:"600 Dia",p:34100},{n:"706 Dia",p:39600},
            {n:"878 Dia",p:49600},{n:"1049 Dia",p:59600},{n:"2195 Dia",p:122100},{n:"3688 Dia",p:200100},{n:"5532 Dia",p:299100},{n:"9288 Dia",p:495100}
        ]
    };
    const pubgData = [
        {n:"60 UC",p:4100},{n:"120 UC",p:8100},{n:"180 UC",p:12100},{n:"240 UC",p:16100},{n:"325 UC",p:20100},{n:"660 UC",p:39600},
        {n:"1800 UC",p:99100},{n:"3850 UC",p:196100},{n:"8100 UC",p:388100}
    ];

    // Navigation Step 1: Shop
    function loadShop(g) {
        activeG = g; qty = 1; sD = ""; sP = 0;
        document.getElementById('qty-val').innerText = qty;
        
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('shop-step-2').style.display = 'none';
        document.getElementById('shop-step-1').style.display = 'block';

        const container = document.getElementById('dynamicItems');
        container.innerHTML = "";

        if (g === 'MLBB') {
    document.body.style.backgroundImage = BG_ML_SHOP;
    document.getElementById('shop-title').innerText = "MOBILE LEGENDS";
    document.getElementById('serverId').style.display = 'block';
    
    // Weekly Pass (Width 100% ·Äï·Ä±·Ä∏·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äô·Äæ screen ·Ää·ÄÆ·Äô·Äæ·Ä¨·Äï·Ä´)
    container.innerHTML += `
        <div class="cat-label">Weekly Pass</div>
        <div class="grid">
            <div class="item-card" style="grid-column: span 2; width: 100%;" onclick="selectItem(this,'${mlData.weekly.n}',${mlData.weekly.p})">
                <img src="${mlData.weekly.icon}">
                <br><span class="item-name">${mlData.weekly.n}</span>
                <span class="item-price">${mlData.weekly.p.toLocaleString()} ks</span>
            </div>
        </div>`;
    
    // Double Diamond (Promo)
    let bth = `<div class="cat-label">Double Diamond (Promo)</div><div class="grid">`;
    mlData.promo.forEach(i => { 
        bth += `<div class="item-card" onclick="selectItem(this,'${i.n}',${i.p})">
                    <img src="https://cdn1.codashop.com/images/106_5e7a01a7-89b9-4b13-a512-a3e72f63f0d1_product/1760334222477_bdd28040-0bd9-4dff-b748-ed7b1a0aecdd.png">
                    <br><span class="item-name">${i.n}</span>
                    <span class="item-price">${i.p.toLocaleString()} ks</span>
                </div>`; 
    });
    container.innerHTML += bth + "</div>";

    // Diamonds
    let nth = `<div class="cat-label">Diamonds</div><div class="grid">`;
    mlData.normal.forEach(i => { 
        nth += `<div class="item-card" onclick="selectItem(this,'${i.n}',${i.p})">
                    <img src="https://cdn1.codashop.com/images/106_5e7a01a7-89b9-4b13-a512-a3e72f63f0d1_product/1760335249005_d119a418-95ae-4562-bd62-135e57cf7504.png">
                    <br><span class="item-name">${i.n}</span>
                    <span class="item-price">${i.p.toLocaleString()} ks</span>
                </div>`; 
    });
    container.innerHTML += nth + "</div>";

        } else {
            document.body.style.backgroundImage = BG_PUBG_SHOP;
            document.getElementById('shop-title').innerText = "PUBG MOBILE UC";
            document.getElementById('serverId').style.display = 'none';
            let pth = `<div class="cat-label">PUBG Mobile UC (All Server)</div><div class="grid">`;
            pubgData.forEach(i => { pth += `<div class="item-card" onclick="selectItem(this,'${i.n}',${i.p})"><img src="https://img.smile.one/media/catalog/product/n/an/nan0ugwrgqjkjmi1611217417.png"><br><span class="item-name">${i.n}</span><span class="item-price">${i.p.toLocaleString()} ks</span></div>`; });
            container.innerHTML += pth + "</div>";
        }
        validateStep1();
    }

    function selectItem(el, n, p) {
        document.querySelectorAll('.item-card').forEach(i => i.classList.remove('active'));
        el.classList.add('active'); sD = n; sP = p; validateStep1();
    }

    function updateQty(val) {
        qty = Math.max(1, qty + val);
        document.getElementById('qty-val').innerText = qty;
        validateStep1();
    }

    function validateStep1() {
        const hasId = document.getElementById('gameId').value.length >= 5;
        const btn = document.getElementById('btnStep1');
        totalPrice = sP * qty;
        
        if (hasId && sD) {
            btn.classList.add('active');
            btn.innerText = `·Äù·Äö·Ä∫·Äô·Ää·Ä∫ (Next) - ${totalPrice.toLocaleString()} ks`;
            btn.disabled = false;
        } else {
            btn.classList.remove('active');
            btn.innerText = "·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Ä°·Äõ·ÄÑ·Ä∫·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´";
            btn.disabled = true;
        }
    }

    // Navigation Step 2: Payment
    function goToPayment() {
        if(!sD) return;

        // Change Background based on Game
        if (activeG === 'MLBB') {
            document.body.style.backgroundImage = BG_ML_PAY;
        } else {
            document.body.style.backgroundImage = BG_PUBG_PAY;
        }

        document.getElementById('shop-step-1').style.display = 'none';
        document.getElementById('shop-step-2').style.display = 'block';

        document.getElementById('final-price').innerText = totalPrice.toLocaleString() + " ks";
        document.getElementById('final-item').innerText = `${sD} x ${qty} (${activeG})`;

        validateStep2();
    }

    function selectPayment(mt, num, name) {
        pMt = mt;
        document.querySelectorAll('.pay-box').forEach(i => i.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById('payment-details').style.display = 'block';
        document.getElementById('pay-method-name').innerText = mt.toUpperCase() + " ·Äî·Ä∂·Äï·Ä´·Äê·Ä∫";
        document.getElementById('display-pay-num').innerText = num;
        document.getElementById('display-pay-name').innerText = "Name: " + name;

        const appLinkBtn = document.getElementById('open-app-link');
        
        if (mt === 'kpay') {
            appLinkBtn.onclick = function(e) {
                e.preventDefault();
                // KPay App ·ÄÄ·Ä≠·ÄØ ·Äê·Ä≠·ÄØ·ÄÄ·Ä∫·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫·ÄÅ·Ä±·Ä´·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
                window.Telegram.WebApp.openLink("kbzpay://");
                
                // Backup ·Ä°·Äî·Ä±·Äñ·Äº·ÄÑ·Ä∑·Ä∫ App ·Äô·Äï·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Ä´·ÄÄ 1 ·ÄÖ·ÄÄ·Äπ·ÄÄ·Äî·Ä∑·Ä∫·Ä°·ÄÄ·Äº·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ Website ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äõ·Äî·Ä∫
                setTimeout(() => {
                    window.Telegram.WebApp.openLink("https://www.kbzpay.com/my");
                }, 1000);
            };
            appLinkBtn.innerText = "üì≤ Open KPay App";
            appLinkBtn.style.background = "#005eab";
            appLinkBtn.style.color = "#fff";
        } else {
            appLinkBtn.onclick = function(e) {
                e.preventDefault();
                // WavePay App ·ÄÄ·Ä≠·ÄØ ·Äê·Ä≠·ÄØ·ÄÄ·Ä∫·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫·ÄÅ·Ä±·Ä´·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
                window.Telegram.WebApp.openLink("wavepay://");
                
                setTimeout(() => {
                    window.Telegram.WebApp.openLink("https://wavemoney.com.mm/");
                }, 1000);
            };
            appLinkBtn.innerText = "üì≤ Open Wave Money";
            appLinkBtn.style.background = "#ffe600";
            appLinkBtn.style.color = "#000";
        }
        
        validateStep2(); 
    }

    function previewFile() {
        const file = document.getElementById('fileInput').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => { 
                document.getElementById('previewImg').src = e.target.result; 
                document.getElementById('previewImg').style.display = "block"; 
                document.getElementById('uploadText').style.display = "none"; 
            };
            reader.readAsDataURL(file);
        }
        validateStep2();
    }

    function validateStep2() {
        const hasFile = document.getElementById('fileInput').files.length > 0;
        const btn = document.getElementById('btnStep2');
        
        if (pMt && hasFile) {
            btn.classList.add('active');
            btn.disabled = false;
        } else {
            btn.classList.remove('active');
            btn.disabled = true;
        }
    }

    function copyNum() {
        const num = document.getElementById('display-pay-num').innerText;
        navigator.clipboard.writeText(num).then(() => alert("Copied!")).catch(() => alert("Use manual copy"));
    }

    function goBack(target) {
        if(target === 'menu') {
            document.getElementById('shop-step-1').style.display = 'none';
            document.getElementById('history-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'flex';
            document.body.style.backgroundImage = BG_MENU;
        } else if (target === 'step1') {
            document.getElementById('shop-step-2').style.display = 'none';
            document.getElementById('shop-step-1').style.display = 'block';
            
            // Revert background to Shop BG
            if(activeG === 'MLBB') document.body.style.backgroundImage = BG_ML_SHOP;
            else document.body.style.backgroundImage = BG_PUBG_SHOP;
        }
    }

    // ID Check Logic
    let timer = null;
    function handleInput() { validateStep1(); clearTimeout(timer); timer = setTimeout(checkID, 1200); }
    
    function getFlag(region) {
        if (!region) return "üè≥Ô∏è";
        const r = region.toLowerCase();
        if (r.includes("myanmar") || r.includes("mm")) return "üá≤üá≤ Myanmar";
        return "üåç " + region;
    }

    async function checkID() {
        const id = document.getElementById('gameId').value;
        const sid = document.getElementById('serverId').value;
        if(!id || id.length < 5) return;
        document.getElementById('nameDisplay').innerText = "Checking...";
        try {
            const url = activeG === 'PUBG' ? `https://check-id-game.p.rapidapi.com/api/rapid_api/cekpubgmobile/${id}` : `https://check-id-game.p.rapidapi.com/api/rapid_api/cek_game_ml/${id}/${sid}`;
            const res = await fetch(url, { headers: { 'x-rapidapi-key': API_KEY, 'x-rapidapi-host': 'check-id-game.p.rapidapi.com' } });
            const data = await res.json();
            if(data.success) { 
                pNm = data.data.username || data.data.name; 
                pCt = getFlag(data.data.region || "Myanmar");
                document.getElementById('nameDisplay').innerHTML = `<div style="font-weight:bold; color:#00ff88; text-shadow:0 0 5px black;">‚úÖ ${pNm}</div><div style="font-size:12px; color:#ddd; font-weight:bold;">${pCt}</div>`;
            } else { 
                document.getElementById('nameDisplay').innerText = "‚ùå ID Not Found"; pNm = "Unknown";
            }
        } catch(e) { document.getElementById('nameDisplay').innerText = "Network Error"; }
    }

    async function sendOrder() {
    const loading = document.getElementById('loadingOverlay');
    loading.style.display = 'flex';
    try {
        const orderID = "JM-" + Math.floor(100000 + Math.random() * 900000);
        const tg = window.Telegram.WebApp;
        const user = tg.initDataUnsafe.user || {};
        const customerId = user.id || "Unknown";
        const orderTime = new Date().toLocaleString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true });
        const gId = document.getElementById('gameId').value;
        const sId = document.getElementById('serverId').value;

        let adminCaption = `üßæ <b>NEW ORDER: ${orderID}</b>\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        adminCaption += `üéÆ <b>Game:</b> ${activeG}\n`;
        adminCaption += `üÜî <b>ID:</b> <code>${gId}</code> ${sId ? '('+sId+')' : ''}\n`;
        adminCaption += `üë§ <b>Name:</b> ${pNm}\n`;
        adminCaption += `üåç <b>Region:</b> ${pCt}\n`;
        adminCaption += `üíé <b>Item:</b> ${sD} <b>x ${qty}</b>\n`;
        adminCaption += `üí∞ <b>Total Price:</b> ${totalPrice.toLocaleString()} ks\n`;
        adminCaption += `üè¶ <b>Pay:</b> ${pMt.toUpperCase()}\n`;
        adminCaption += `üìÖ <b>Time:</b> ${orderTime}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        adminCaption += `üë§ <b>Cust ID:</b> <code>${customerId}</code>`;

        const formData = new FormData();
        formData.append("chat_id", ADMIN_ID);
        formData.append("photo", document.getElementById('fileInput').files[0]);
        formData.append("caption", adminCaption);
        formData.append("parse_mode", "HTML");
        formData.append("reply_markup", JSON.stringify({
            inline_keyboard: [[{ text: "‚úÖ Confirm", callback_data: `ok_${orderID}` }, { text: "‚ùå Reject", callback_data: `no_${orderID}` }]]
        }));

        const response = await fetch(`https://api.telegram.org/bot${BOT_T}/sendPhoto`, { method: 'POST', body: formData });
        
        if (response.ok) {
            // Customer ·ÄÜ·ÄÆ ·Äï·Äº·Äô·Ää·Ä∑·Ä∫ ·ÄÖ·Ä¨·Äû·Ä¨·Ä∏·Äï·ÄØ·Ä∂·ÄÖ·Ä∂
            const successMsg = `‚åõ Order ·Äê·ÄÑ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫!\n\n` +
                             `üÜî Order ID: ${orderID}\n` +
                             `üéÆ Game ID: ${gId} ${sId ? '['+sId+']' : ''}\n` +
                             `üåç Region: ${pCt}\n` +
                             `üíé ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏: ${sD} x ${qty}\n` +
                             `üìÖ Time: ${orderTime}\n\n` +
                             `Admin ·Äô·Äæ ·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·ÄÄ ·ÄÖ·Ä≠·Äî·Ä∫·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä±·Ä∏·Äû·ÄΩ·Ä¨·Ä∏·Äô·Ää·Ä∫ ·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äê·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã`;

            tg.showConfirm(successMsg, function() {
                tg.close();
            });
        } else { alert("Telegram Bot Error."); }
    } catch (e) { alert("System Error: " + e.message); } finally { loading.style.display = 'none'; }
}

    function showHistory() {
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('history-screen').style.display = 'block';
        const list = document.getElementById('historyList');
        const history = JSON.parse(localStorage.getItem('jm_orders') || '[]');
        if (history.length === 0) { list.innerHTML = `<p style="text-align:center; color:#ccc; margin-top:50px;">No History</p>`; }
        else { list.innerHTML = history.reverse().map(h => `<div class="history-card"><span class="h-price">${h.price}</span><div style="color:#f1c40f; font-weight:bold;">${h.id}</div><div style="font-size:12px; color:#aaa;">${h.game} | ${h.gameId}</div><div style="font-size:11px; color:#ddd;">${h.time}</div></div>`).join(''); }
    }
</script>
</body>
</html>